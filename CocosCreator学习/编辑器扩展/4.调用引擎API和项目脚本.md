<!-- TOC -->

- [调用引擎 API 和项目脚本](#调用引擎-api-和项目脚本)
    - [注册场景脚本](#注册场景脚本)
    - [编写场景脚本](#编写场景脚本)
    - [扩展包向场景脚本发送消息](#扩展包向场景脚本发送消息)

<!-- /TOC -->
# 调用引擎 API 和项目脚本

在插件中可以声明一个特殊的脚本文件（场景脚本），该脚本和项目中的脚本 （assets 目录下的脚本）具有相同的环境，也就是说在这个脚本里可以调用引擎 API 和其他项目脚本，实现  
* 遍历场景中的节点，获取或改动数据
* 调用项目中的其他脚本完成工作

## 注册场景脚本
**package.json**的 **scene-script** 字段

```js
"scene-script": "scene-walker.js"
```

## 编写场景脚本

```js
module.exports = {
    'get-canvas-children': function (event) {
        var canvas = cc.find('Canvas');
        Editor.log('children length : ' + canvas.children.length);

        if (event.reply) {
            event.reply(null, canvas.children.length);
        }
    }
};
```

## 扩展包向场景脚本发送消息

```js
Editor.Scene.callSceneScript('foobar', 'get-canvas-children', function (err, length) {
    console.log(`get-canvas-children callback : length - ${length}`);
});
```


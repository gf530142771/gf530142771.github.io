<!-- TOC -->

- [字符串扩展](#字符串扩展)
    - [字符Unicode的表示法](#字符unicode的表示法)
    - [新增方法](#新增方法)
    - [模板字符串](#模板字符串)
    - [模板字符串](#模板字符串-1)

<!-- /TOC -->
## 字符串扩展
### 字符Unicode的表示法
ES6 加强了unicode 的支持  
ES5 这种表示法只限于码点在\u0000~\uFFFF之间的字符。超出这个范围的字符，必须用两个双字节的形式表示。
ES6 对这一点做出了改进，只要将码点放入大括号，就能正确解读该字符。
* codePointAt()
Javascript 内部 字符以UTF-16格式存储，每个字符2个字节
codePointAt 能正确处理四个字节存储的字符
```js
let s = "𠮷a";
console.log(s.codePointAt(0));
console.log(s.codePointAt(1));
console.log(s.codePointAt(2));
/*
134071
57271
9
*/
```
"𠮷a"是三个字符  
codePointAt方法的参数，仍然是不正确的。比如，上面代码中，字符a在字符串s的正确位置序号应该是 1，但是必须向codePointAt方法传入 2。解决这个问题的一个办法是使用for...of循环，因为它会正确识别 32 位的 UTF-16 字符。
```js
let s = "𠮷a";
for (let code of s) {
    console.log(code);
}
/*
𠮷
a
*/
```

* at()  
这个方法可以通过垫片库实现 可以识别 Unicode 编号大于0xFFFF的字符，返回正确的字符。
### 新增方法
* includes()  
返回bool值 表示是否找到了字符串
* startWith()  
返回布尔值，表示参数字符串是否在原字符串的头部。
* endsWith()  
返回布尔值，表示参数字符串是否在原字符串的尾部。
```js
let s2 = "hello world";
console.log(s2.includes("world"));//true
console.log(s2.startsWith("hello"));//true
console.log(s2.endsWith("ad"));//false
//这三个方法都支持第二个参数，表示开始搜索的位置。
s.startsWith('world', 6) // true
s.endsWith('hello', 5) // true
s.includes('hello', 6) // false
```

* repeat()  
返回一个重复那次的字符串
```js
'x'.repeat(3) // "xxx"
'hello'.repeat(2) // "hellohello"
'na'.repeat(0) // ""
// 参数如果是小数，会被取整。
'na'.repeat(2.9) // "nana"
```

* padStart() padEnd()  
字符串补全
```js
'x'.padStart(5, 'ab') // 'ababx'
'x'.padStart(4, 'ab') // 'abax'

'x'.padEnd(5, 'ab') // 'xabab'
'x'.padEnd(4, 'ab') // 'xaba'

// 如果省略第二个参数，默认使用空格补全长度。
'x'.padStart(4) // '   x'
'x'.padEnd(4) // 'x   '
```

### 模板字符串  
模板字符串（template string）是增强版的字符串，用反引号（`）标识。它可以当作普通字符串使用，也可以用来定义多行字符串，或者在字符串中嵌入变量。
```js
// 普通字符串
`In JavaScript '\n' is a line-feed.`

// 多行字符串
`In JavaScript this is
 not legal.`

console.log(`string text line 1
string text line 2`);

// 字符串中嵌入变量 模板字符串中嵌入变量，需要将变量名写在${}之中。
let name = "Bob", time = "today";
`Hello ${name}, how are you ${time}?`
// 大括号内部可以放入任意的 JavaScript 表达式，可以进行运算，以及引用对象属性。
let x = 1;
let y = 2;

`${x} + ${y} = ${x + y}`
// "1 + 2 = 3"

`${x} + ${y * 2} = ${x + y * 2}`
// "1 + 4 = 5"

let obj = {x: 1, y: 2};
`${obj.x + obj.y}`
// "3"
// 模板字符串之中还能调用函数。
function fn() {
  return "Hello World";
}

`foo ${fn()} bar`
// foo Hello World bar
// 模板字符串甚至还能嵌套。
let addrs = [{ first: 1, last: 2 }, { first: 3, last: 4 }];
const tmpl = addrs => `
<table>
  ${addrs.map(addr => `
    <tr><td>${addr.first}</td></tr>
    <tr><td>${addr.last}</td></tr>
  `).join('')}
</table>
`;
console.log(tmpl(addrs));
/*
<table>
  
    <tr><td>1</td></tr>
    <tr><td>2</td></tr>
  
    <tr><td>3</td></tr>
    <tr><td>4</td></tr>
  
</table>
*/
```
### 模板字符串
```js
function compile(template) {
    const evalExpr = /<%=(.+?)%>/g;
    const expr = /<%(.+?)%>/g;

    template = template
        .replace(evalExpr, '`); \n  echo( $1 ); \n  echo(`')
        .replace(expr, '`); \n $1 \n  echo(`');

    template = 'echo(`' + template + '`);';

    console.log(template);

    let script =
        `(function parse(data){
      let output = "";
  
      function echo(html){
        output += html;
      }
  
      ${template}
  
      return output;
    })`;

    return script;
}

let parse = eval(compile(template));
console.log(parse({ supplies: ["broom", "mop", "cleaner"] }));
```





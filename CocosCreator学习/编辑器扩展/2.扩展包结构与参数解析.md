<!-- TOC -->

- [扩展包结构与参数解析](#扩展包结构与参数解析)
    - [创建并安装扩展包](#创建并安装扩展包)
    - [package.json参数解析](#packagejson参数解析)
    - [入口程序](#入口程序)
            - [生命周期](#生命周期)

<!-- /TOC -->

## 扩展包结构与参数解析


### 创建并安装扩展包

创建如下结构的目录结构 放入项目的**packages**文件夹下

```
hello-world
  |--main.js
  |--package.json
```

### package.json参数解析  

```json
{
  "name": "hello-world",
  "version": "0.0.1",
  "description": "一份简单的扩展包",
  "author": "Cocos Creator",
  "main": "main.js",
  "main-menu": {
    "Packages/Hello World": {
      "message": "hello-world:say-hello"
    }
  }
}

```  
|参数|介绍|
|:--|:--|
|name|**String**-扩展包名称(**必须**),保证全局唯一性|
|version|**String**-扩展包的版本号(**必须**)|
|description|**String**-扩展包的描述(**可选**)|
|author|**String**-作者(**可选**)|
|main|**String**-入口程序(**可选**)|
|main-menu|**Object**-主菜单定义 在编辑器的主菜单显示相应按钮(**可选**)参考[主菜单字段参考](字段参考.md#主菜单字段参考)|
|panel|**Obejct** 用于注册开发面板参考[panel字段参考](字段参考.md#面板字段参考)|
|reload|**Obejct** 定制扩展包自动重载的文件监控规则|
|runtime-resource |**Obejct** 资源映射,将扩展的资源映射到资源管理器|
|scene-script |**Obejct** 字段用于声明一个扩展包内的脚本，在该脚本中可以使用引擎 API，并访问当前场景中的节点和组件。[调用引擎API和项目脚本](4.调用引擎API和项目脚本.md)|

范例:  
* runtime-resource  资源映射
```json
"runtime-resource": {
    "path": "path/to/runtime-resource",
    "name": "shared-resource"
  }
```
上述声明会将 projectPath/packages/myPackage/path/to/runtime-resource 路径下的全部资源都映射到资源管理器中，显示为 [myPackage]-[shared-resource]。

* main-menu 扩展菜单路径  

```json
{
  "main-menu": {
    "Examples/FooBar": {
      "message": "my-package:foo"
    },
    "Examples/FooBar/Bar": {
      "message": "my-package:bar"
    }
  }
}
```
在这个例子中，我们先在主菜单中注册了一份菜单路径 Examples/Foobar，这之后我们又注册了 Examples/Foobar/Bar，而第二个菜单路径的注册要求 Foobar 的类型为一个分级子菜单（submenu），然而由于上一次的注册已经将 Foobar 的类型定义为菜单选项（menu-item），从而导致了注册失败。

* panel   
panel (Object)
用于面板注册。面板注册的键值（Key）是一个以 panel 开头的字符串，字符串后面可跟上后缀名用于多面板的注册。  
注册完成的面板，将会生成以 ${包名}${面板后缀名} 为组合的面板 ID。通常情况下如果我们只注册一个面板，就不需要带后缀名，面板 ID 默认就是插件包的名字。但如果是注册多个面板，就需要带后缀名，以便区分。  
关于多面板注册，这里我们提供了一个简单的例子，在 package.json 中：

```json
{
  "name": "simple-package",
  "panel": {
    "main": "panel/index.js",
    "type": "dockable",
    "title": "Simple Panel",
    "width": 400,
    "height": 300
  },
  "panel.02": {
    "main": "panel.02/index.js",
    "type": "dockable",
    "title": "Simple Panel 02",
    "width": 400,
    "height": 300
  },
}
```


### 入口程序
* 初始化扩展包
* 执行后台操作程序
* 调用CocosCreator主进程中的方法
* 管理扩展面板的开启和关闭

**简单范例**
```javascript
'use strict';
module.exports = {
  load () {
    Editor.log('package loaded');
  },

  unload () {
    Editor.log('package unloaded');
  },
};
```

##### 生命周期
* load  
当扩展包正确载入后，将会执行用户入口程序中的 load 函数。我们可以在这里做一些关于扩展包本身的初始化操作。
 
* unload  
当扩展包卸载进行到最后阶段，将会执行用户入口程序中的 unload 函数。我们可以在这里做一些扩展包卸载前的清理操作。  

* 加载和卸载注意事项  
Cocos Creator 支持在编辑器运行时动态的添加和删除扩展包，所以要注意如果扩展包依赖编辑器其他模块的特定工作状态时，必须在 load 和 unload 里进行妥善处理。如果插件的动态加载和卸载导致其他模块工作异常时，扩展包的用户总是可以选择关闭编辑器后重新启动。

* IPC 消息注册  
在入口程序中添加 messages 字段，可以让扩展包在加载的时候进行主进程的 IPC 消息注册。样例如下：
    ```javascript
    'use strict';

    module.exports = {
    messages {
        'foo-bar' ( event ) { Editor.log('hello foobar'); },
        'scene:saved' ( event ) { Editor.log('scene saved!'); },
    },
    };
    ```



<!-- TOC -->

- [短链接](#短链接)
    - [简单使用](#简单使用)
    - [封装的网络请求代码](#封装的网络请求代码)

<!-- /TOC -->

## 短链接
### 简单使用
```js  
let xhr = new XMLHttpRequest();
 xhr.onreadystatechange = function () {
     if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {
         var response = xhr.responseText;
         console.log(response);
     }
 };
 xhr.open("GET", url, true);
 xhr.send();
```

### 封装的网络请求代码
```js
let TAG = 'NetWork'
export const EnumNetworkError = {
    kNetworkErrorTimeout: 'kNetworkErrorTimeout',
    kNetworkErrorAbort: 'kNetworkErrorAbort',
    kNetworkErrorError: 'kNetworkErrorError',
}

export const EnumEncryType = {
    EnumEncryTypeNone: 'EnumEncryTypeNone',
    EnumEncryTypeAES: 'EnumEncryTypeAES'
}

export const NetWork = (function () {
    let object = new Object();
    /**
     * url 请求地址
     * reqData 请求的数据
     * reqType http的请求方法
     */
    object.request = function ({ url = '', reqData = {}, reqType = 'POST', async = true, callback = null, errorCallback = null, encryType = EnumEncryType.EnumEncryTypeNone } = {}) {
        let params = '';
        for (let key in reqData) {
            params += (key + '=' + reqData[key] + '&')
        }
        console.log(TAG, 'url: ' + url + ' params: ' + params);
        // return;
        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            console.log(TAG, 'readyState: ' + xhr.readyState + ' status: ' + xhr.status + ' statusText: ' + xhr.statusText);
            // 0：请求未初始化（还没有调用 open()）。
            // 1：请求已经建立，但是还没有发送（还没有调用 send()）。
            // 2：请求已发送，正在处理中（通常现在可以从响应中获取内容头）。
            // 3：请求在处理中；通常响应中已有部分数据可用了，但是服务器还没有完成响应的生成。
            // 4：响应已完成；您可以获取并使用服务器的响应了。
            if (xhr.readyState == 4) {
                if (xhr.status == 200) {// 响应中的数字状态码：表示为有效响应，成功的请求
                    var response = xhr.responseText;
                    if (response) {
                        console.log(TAG, 'response:' + response);
                        if (callback && typeof callback === 'function') {
                            callback(response);
                        }
                    } else {
                        console.log(TAG, 'no response data');
                    }
                } else {

                    //失败
                    console.log(TAG, 'request url: ' + url + 'fail' + ' status: ' + xhr.status + ' statusText: ' + xhr.statusText);
                    if (errorCallback && typeof errorCallback === 'function') {
                        errorCallback(xhr.statusText);
                    }
                }
            }
        };

        xhr.ontimeout = function () {
            console.log(TAG, 'ontimeout');
            if (errorCallback && typeof errorCallback === 'function') {
                errorCallback(EnumNetworkError.kNetworkErrorTimeout);
            }
        }
        xhr.onabort = function () {
            console.log(TAG, 'onabort');
            if (errorCallback && typeof errorCallback === 'function') {
                errorCallback(EnumNetworkError.kNetworkErrorAbort);
            }
        }
        xhr.onerror = function () {
            //出现错误
            console.log(TAG, 'onerror');
            if (errorCallback && typeof errorCallback === 'function') {
                errorCallback(EnumNetworkError.kNetworkErrorError);
            }
        }

        xhr.onload = function () {
            console.log(TAG, 'onload');
        }
        xhr.onloadend = function () {
            console.log(TAG, 'onloadend');
        }
        xhr.onloadstart = function () {
            console.log(TAG, 'onloadstart');
        }
        xhr.onprogress = function () {
            console.log(TAG, 'onprogress');
        }

        if (reqType == "GET") {
            xhr.open(reqType, url + "?" + params, async);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.send("");
        } else if (reqType == "POST") {
            xhr.open(reqType, url, async);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.send(params);
        }
    }
    return object;
})();
```
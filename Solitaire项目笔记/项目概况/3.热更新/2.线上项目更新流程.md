# 线上项目更新流程

## 具体流程参考文档
[点击这里](https://n5419vb5ha.feishu.cn/docs/doccn1zJDfpX5fThGPgrNgypwOc)

## 更新流程简单梳理
### 更新代码和资源的生成
1. 检查三个项目solitaire_client、sub-project、solitaire-editor热更分支。
2. 注意版本号 **solitaire_client/sub-project/ver_config/config.json**的**Release.scriptVersion** 版本号一般+5。
```json
{
    "Debug": {
        "packageUrl": "http://s3.elestorm.com:8089/solitaire/aaa_spider_script/", 
        "remoteManifestUrl": "http://s3.elestorm.com:8089/solitaire/aaa_spider_script/", 
        "remoteVersionUrl": "http://s3.elestorm.com:8089/solitaire/aaa_spider_script/version.manifest", 
        "resourceUrl": "http://s3.elestorm.com:8089/solitaire/", 
        "scriptVersion": "10615"
    }, 
    
    "Release": {
        "packageUrl": "https://d3ojlo1yamgaff.cloudfront.net/aaa_spider_script/", 
        "remoteManifestUrl": "https://d3ojlo1yamgaff.cloudfront.net/aaa_spider_script/", 
        "remoteVersionUrl": "https://d3ojlo1yamgaff.cloudfront.net/aaa_spider_script/version.manifest", 
        "resourceUrl": "https://d3ojlo1yamgaff.cloudfront.net/", 
        "scriptVersion": "13045"
    }
}
```

3. 使用脚本发布刚更新的脚本.
定位到目录**solitaire_client/sub-project/tools/**   
使用脚本
```
python publish_js.py
```
会出现两次确认  
第一次输入 0，  
第二次查看信息是否正确,正确按y  
会在**solitaire_client/publish/script**目录下生成热更的脚本文件。  
4. 资源的热更文件生成参考[文档](https://n5419vb5ha.feishu.cn/docs/doccn1zJDfpX5fThGPgrNgypwOc)

### 更新脚本和资源的上传。  
以文档为准，查看流程图自己校对每个步骤
脚本流程分为
```flow
start=>start: 开始
selectPro=>operation: 选择项目
totemp=>operation: 点开临时文件夹aaatemp 删除旧版本，上传新版本，会自动解压，解压成功后飞书自动通知
move=>operation: 将该文件夹移动至aaa_spider_script
uploadVer=>operation: 上传版本信息并覆盖
invalid=>operation: 做失效处理,具操作参照文档
start->selectPro->totemp->move->uploadVer->invalid
```

## 更新注意事项
### 1.修改线上版本bug
首先要切换到线上版本的最新分支，一般是**release_版本号**的形式。再此分支修改。修改完成后，测试，然后走热更流程。完成后，提交一次修改，保留记录。

### 2.大版本更新。
使用master分支,走**热更流程**，热更完成后，分出**release_版本号**的形式的分支备份，用于线上版本的bug修改和还原。
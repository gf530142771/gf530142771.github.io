## 网络下载

### 自写的工具类
```js
let TAG = 'DownloadUtils';
export class Downloader {
    constructor() {
        this.downloader = null;
        this.taskSuccessCallback = null;
        this.taskProgressCallback = null;
        this.taskErrorCallback = null;
    }
    downFile({ downUrl = '',
        savePath = '',
        saveFileName = '',
        taskSuccessCallback = null,
        taskProgressCallback = null,
        taskErrorCallback = null } = {}) {
        //创建Savepath
        let path = jsb.fileUtils.getWritablePath() + savePath;
        var initDir = jsb.fileUtils.createDirectory(path);
        if (!initDir) {
            console.log(TAG, 'initDir fail');
            if (this.taskErrorCallback) {
                this.taskErrorCallback(null, null, null, "initDir fail");
            }

            return;
        }
        this.downloader = new jsb.Downloader();
        this.downloader.setOnFileTaskSuccess(this.onSucceed.bind(this));
        this.downloader.setOnTaskProgress(this.onProgress.bind(this));
        this.downloader.setOnTaskError(this.onError.bind(this));
        if (taskSuccessCallback) {
            this.taskSuccessCallback = taskSuccessCallback;
        }

        if (taskProgressCallback) {
            this.taskProgressCallback = taskProgressCallback;
        }

        if (taskErrorCallback) {
            this.taskErrorCallback = taskErrorCallback;
        }
        this.downloader.createDownloadFileTask(downUrl, path + saveFileName);
    }

    onSucceed(task) {
        this.task = task;
        if (this.taskSuccessCallback) {

            this.taskSuccessCallback({
                task: task
            });
        }
    }
    /**
     * 
     * @param {*} task 
     * @param {long } bytesReceived 本次接收的数据大小
     * @param {long } totalBytesReceived 文件的大小
     * @param {long } totalBytesExpected 累计接收的数据大小
     */
    onProgress(task, bytesReceived, totalBytesReceived, totalBytesExpected) {
        console.log(TAG, 'bytesReceived:' + bytesReceived + ' totalBytesReceived: ' + totalBytesExpected + ' totalBytesExpected: ' + totalBytesReceived);
        this.task = task;
        if (this.taskProgressCallback) {
            let progress = totalBytesReceived / totalBytesExpected * 100;
            this.taskProgressCallback({
                task: task,
                bytesReceived: bytesReceived,
                totalBytesReceived: totalBytesReceived,
                totalBytesExpected: totalBytesExpected,
                progress: progress
            });
        }
    }

    onError(task, errorCode, errorCodeInternal, errorStr) {
        this.task = task;
        let errorStr2 = 'Failed to download file (' + task.requestURL + '): ' + errorStr + '(' + errorCode + ')';
        console.log(TAG, errorStr2);
        if (this.taskErrorCallback) {
            this.taskErrorCallback({
                task: task,
                errorCode: errorCode,
                errorCodeInternal: errorCodeInternal,
                errorStr: errorStr
            });
        }
    }
}
```